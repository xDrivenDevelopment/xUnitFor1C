Перем юТест;

Функция ПолучитьСписокТестов(ЮнитТестирование) Экспорт
	
	юТест = ЮнитТестирование;
	
	ВсеТесты = Новый Массив;
	ВсеТесты.Добавить("Тест_ПроверитьОтчетНаСоответствиеЭталону");
	
	Возврат ВсеТесты;
	
КонецФункции

Процедура ПередЗапускомТеста() Экспорт
	
	//юТест.ВывестиСообщение("Перед запуском теста");
	НачатьТранзакцию();
	
КонецПроцедуры

Процедура ПослеЗапускаТеста() Экспорт
	
	//юТест.ВывестиСообщение("После запуска теста");
	Если ТранзакцияАктивна() Тогда
		ОтменитьТранзакцию();
	КонецЕсли;
	
КонецПроцедуры

Процедура Тест_ПроверитьОтчетНаСоответствиеЭталону() Экспорт
	Перем Расшифровка; // сюда будет передана информация расшифровки СКД, т.к. в эталоне она тоже есть
	
	// создание тестовых данных из табличного документа
	МакетТестовыеДанные = ПолучитьМакет("ТестовыеДанные");
	КоличествоСозданных = 0; // 7
	ТестовыеДанные = юТест.СоздатьДанныеПоТабличномуДокументу(МакетТестовыеДанные, КоличествоСозданных);
	юТест.ПроверитьРавенство(КоличествоСозданных, 7, "Ожидали, что будет создано 7 элементов");
	
	// Получение эталонного отчета
	// Важно эталон получать именно так из-за плясок с кодом языка макета
	МакетЭталона = ПолучитьМакет("Эталон");
	Эталон = Новый ТабличныйДокумент;
	Эталон.Вывести(МакетЭталона);
	
	// Формирование отчета
	РезультатОтчета = Новый ТабличныйДокумент;
	Отчет = Отчеты.ТестовыйОтчетСКДДляСравнениеСЭталоном.Создать();
	Отчет.СкомпоноватьРезультат(РезультатОтчета, Расшифровка);
	
	// Сохранение в файлы mxl
	ИмяФайлаЭталона = ПолучитьИмяВременногоФайла("mxl");
	ИмяФайлаРезультатаОтчета = ПолучитьИмяВременногоФайла("mxl");
	Эталон.Записать(ИмяФайлаЭталона);
	РезультатОтчета.Записать(ИмяФайлаРезультатаОтчета);
	
	// Сравнение файлов
	
	// Если Истина, то будет показано окно демонстрации различий, если файлы различны
	// Использовать только для расследования ошибки, если тест падает на сравнении
	ПоказатьРазличия = Ложь;
	
	// ПараметрыСравнения заполняется по необходимости. Если не заполнены, то используются значения по умолчанию платформы
	// Если не указан способ сравнения, будет попытка определить автоматически по расширению файла:
	//  mxl - ТабличныйДокумент
	//  txt,xml - ТекстовыйДокумент
	ПараметрыСравнения = Новый Структура;
	//ПараметрыСравнения.Вставить("ИгнорироватьПустоеПространство", Истина);
	//ПараметрыСравнения.Вставить("УчитыватьРазделителиСтрок", Ложь);
	//ПараметрыСравнения.Вставить("УчитыватьРегистр", Ложь);
	//ПараметрыСравнения.Вставить("СпособСравнения", СпособСравненияФайлов.ТекстовыйДокумент);
	
	юТест.ПроверитьРавенствоФайлов(ИмяФайлаЭталона, ИмяФайлаРезультатаОтчета,
		"Ожидали, что результат отчета соответствует эталону", ПараметрыСравнения, ПоказатьРазличия);
	
КонецПроцедуры
